# 《AI智能·学习搭子》实验/实训报告

## 第2.2章 详细设计

#### 2.2.1 引言

**编写目的**：
本文档详细描述"AI智能·学习搭子"系统的技术架构、功能模块设计、界面设计和核心模块实现方案，为系统开发提供详细的技术规格说明。

**背景**：
基于需求分析的结果，本章节将详细设计系统的技术架构、数据库结构、API接口、用户界面和核心业务逻辑，确保系统能够满足功能需求和非功能需求。

**定义**：
- **多租户架构**：支持多个学校/机构独立使用同一套系统的架构模式
- **RLS**：Row Level Security，行级安全策略，确保数据隔离
- **AI Provider**：AI服务提供商抽象接口，支持多种AI服务
- **学习搭子**：AI助手的拟人化角色，提供情感化学习陪伴

**参考资料**：
- Next.js 15官方文档
- Supabase官方文档
- 阿里云通义千问API文档
- Ant Design组件库文档

#### 2.2.2 系统成本分析与进度

**成本分析**：

| 成本项目 | 开发阶段 | 运营阶段（年） | 说明 |
|---------|---------|---------------|------|
| **人力成本** | | | |
| 前端开发工程师 | 3人×3月×15k | 1人×12月×15k | React/Next.js开发 |
| 后端开发工程师 | 2人×3月×18k | 1人×12月×18k | Node.js/数据库开发 |
| AI算法工程师 | 1人×2月×20k | 0.5人×12月×20k | AI模型集成优化 |
| UI/UX设计师 | 1人×1月×12k | 0.2人×12月×12k | 界面设计优化 |
| 测试工程师 | 1人×1月×10k | 0.3人×12月×10k | 功能测试 |
| **软件成本** | | | |
| 开发工具 | 5k | 5k | IDE、设计软件等 |
| 第三方服务 | 10k | 30k | AI API、云服务等 |
| **硬件成本** | | | |
| 开发设备 | 20k | 5k | 服务器、开发机等 |
| **云服务成本** | | | |
| 阿里云ECS | 0 | 12k | 2核4GB配置 |
| PostgreSQL数据库 | 0 | 8k | 云数据库服务 |
| CDN和存储 | 0 | 6k | 静态资源加速 |
| **总成本** | **约50万元** | **约30万元/年** | |

**进度安排**：

```
项目甘特图

2024年1月    2024年2月    2024年3月    2024年4月
|----------|----------|----------|----------|
需求分析    ████████
系统设计    ████████
数据库设计  ████████
前端开发    ████████████████
后端开发    ████████████████
AI集成      ████████████
测试调试    ████████
部署上线    ████████
```

**关键里程碑**：
- Week 2：完成需求分析和系统设计
- Week 6：完成核心功能开发
- Week 8：完成AI功能集成
- Week 10：完成系统测试
- Week 12：系统部署上线

#### 2.2.3 程序系统的结构

**系统架构图**：

```
                    AI智能·学习搭子系统架构图
                    
┌─────────────────────────────────────────────────────────────┐
│                        客户端层                              │
├─────────────────────────────────────────────────────────────┤
│  Web浏览器    │  移动端H5    │  平板端     │  桌面端        │
│  (Chrome)    │  (Safari)   │  (iPad)    │  (Electron)   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        应用层                               │
├─────────────────────────────────────────────────────────────┤
│  Next.js 15 应用服务器                                       │
│  ├── 页面路由 (App Router)                                  │
│  ├── API路由 (API Routes)                                   │
│  ├── 中间件 (Middleware)                                    │
│  └── 服务端组件 (Server Components)                         │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        业务逻辑层                            │
├─────────────────────────────────────────────────────────────┤
│  ├── 用户认证模块 (Supabase Auth)                           │
│  ├── 学习规划模块 (AI Plan Generator)                     │
│  ├── 智能问答模块 (AI Chat Service)                         │
│  ├── 进度追踪模块 (Learning Analytics)                     │
│  ├── 情感交互模块 (Emotional AI)                           │
│  └── 多租户管理模块 (Tenant Management)                     │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        数据访问层                            │
├─────────────────────────────────────────────────────────────┤
│  Drizzle ORM + PostgreSQL                                   │
│  ├── 用户数据 (Users, Profiles)                             │
│  ├── 学习数据 (Goals, Plans, Tasks)                         │
│  ├── 对话数据 (Sessions, Messages)                          │
│  ├── 分析数据 (Analytics, Stats)                            │
│  └── 系统数据 (Tenants, Configs)                           │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        外部服务层                            │
├─────────────────────────────────────────────────────────────┤
│  ├── 阿里云通义千问 API                                     │
│  ├── Supabase 认证服务                                      │
│  ├── 阿里云 OSS 存储                                        │
│  └── 阿里云 CDN 加速                                        │
└─────────────────────────────────────────────────────────────┘
```

**功能模块设计**：

```
                    AI智能·学习搭子系统功能模块图

┌─────────────────────────────────────────────────────────────┐
│                        用户界面层                            │
├─────────────────────────────────────────────────────────────┤
│  登录注册  │  学习仪表板  │  AI聊天  │  学习计划  │  进度分析  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        业务服务层                            │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ 用户管理服务 │  │ 学习规划服务 │  │ 智能问答服务 │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ 进度追踪服务 │  │ 情感交互服务 │  │ 数据分析服务 │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        数据存储层                            │
├─────────────────────────────────────────────────────────────┤
│  PostgreSQL 数据库                                           │
│  ├── auth.users (用户认证)                                  │
│  ├── profiles (用户档案)                                    │
│  ├── tenants (租户信息)                                     │
│  ├── learning_goals (学习目标)                              │
│  ├── learning_plans (学习计划)                              │
│  ├── learning_tasks (学习任务)                              │
│  ├── daily_plans (每日计划)                                │
│  ├── assistant_sessions (对话会话)                         │
│  ├── assistant_messages (对话消息)                         │
│  └── journal_entries (学习日记)                            │
└─────────────────────────────────────────────────────────────┘
```

#### 2.2.4 界面设计

**设计原则**：
- **简洁性**：界面简洁明了，减少用户认知负担
- **一致性**：保持设计元素和交互模式的一致性
- **响应式**：适配不同设备和屏幕尺寸
- **可访问性**：支持无障碍访问，符合WCAG标准

**主要界面设计**：

*1. 登录注册界面*：
- 简洁的登录表单，支持邮箱和密码登录
- 清晰的错误提示和成功反馈
- 响应式设计，适配移动端

*2. 学习仪表板*：
- 左侧：学习目标管理和进度概览
- 中央：今日学习计划和任务列表
- 右侧：AI聊天助手和快速操作

*3. AI聊天界面*：
- 类似微信的对话界面设计
- 支持文本、图片、文件等多种消息类型
- 实时消息状态显示

*4. 学习计划界面*：
- 可视化学习计划展示
- 支持计划编辑和调整
- 进度条和完成状态显示

*5. 进度分析界面*：
- 图表化数据展示
- 学习趋势分析
- 个性化建议展示

**响应式设计**：
- **桌面端**：1200px+，三栏布局
- **平板端**：768px-1199px，两栏布局
- **手机端**：<768px，单栏布局

#### 2.2.5 核心模块详细设计

**2.2.5.1 用户登录模块**

*程序描述*：
用户登录模块负责处理用户身份认证，支持邮箱密码登录，集成Supabase认证服务，实现多租户用户隔离。

*功能*：
- 用户注册和登录
- 密码加密存储
- 会话管理
- 多租户用户隔离
- 角色权限验证

*性能*：
- 登录响应时间 < 500ms
- 支持1000+并发登录
- 会话超时自动处理

*输入项*：
- 邮箱地址（string）
- 密码（string）
- 租户ID（uuid）

*输出项*：
- 用户信息（UserProfile）
- 访问令牌（JWT Token）
- 权限列表（Permission[]）

*算法与流程逻辑*：

```
用户登录流程图

开始
  │
  ▼
输入邮箱密码
  │
  ▼
验证邮箱格式
  │
  ▼
查询用户信息
  │
  ▼
验证密码哈希
  │
  ▼
检查租户权限
  │
  ▼
生成访问令牌
  │
  ▼
记录登录日志
  │
  ▼
返回用户信息
  │
  ▼
结束
```

*接口*：
```typescript
interface LoginRequest {
  email: string;
  password: string;
  tenantId: string;
}

interface LoginResponse {
  user: UserProfile;
  token: string;
  permissions: string[];
}
```

*存储分配*：
- users表：存储用户基本信息
- profiles表：存储用户档案信息
- sessions表：存储会话信息
- tenants表：存储租户信息

*测试计划*：
- 正常登录测试
- 错误密码测试
- 无效邮箱测试
- 并发登录测试
- 会话超时测试

**2.2.5.2 智能问答模块**

*程序描述*：
智能问答模块集成阿里云通义千问API，提供24/7智能问答服务，支持上下文理解、学习资源推荐和个性化回答。

*功能*：
- 自然语言问答
- 上下文理解
- 学习资源推荐
- 问题分类
- 回答质量评估

*性能*：
- API响应时间 < 2秒
- 支持100+并发问答
- 回答准确率 > 85%

*输入项*：
- 用户问题（string）
- 上下文信息（Context）
- 用户ID（uuid）
- 会话ID（uuid）

*输出项*：
- AI回答（string）
- 问题分类（string）
- 置信度（number）
- 推荐资源（Resource[]）

*算法与流程逻辑*：

```
智能问答流程图

开始
  │
  ▼
接收用户问题
  │
  ▼
问题预处理
  │
  ▼
构建上下文
  │
  ▼
调用AI API
  │
  ▼
解析AI回答
  │
  ▼
问题分类
  │
  ▼
生成推荐资源
  │
  ▼
保存对话记录
  │
  ▼
返回回答结果
  │
  ▼
结束
```

*接口*：
```typescript
interface QuestionRequest {
  question: string;
  context?: string;
  userId: string;
  sessionId: string;
}

interface QuestionResponse {
  answer: string;
  category: string;
  confidence: number;
  resources: Resource[];
  followUpQuestions: string[];
}
```

*存储分配*：
- assistant_sessions表：存储对话会话
- assistant_messages表：存储对话消息
- learning_resources表：存储学习资源

*测试计划*：
- 基础问答测试
- 上下文理解测试
- 复杂问题测试
- API异常处理测试
- 并发问答测试

**2.2.5.3 学习规划模块**

*程序描述*：
学习规划模块基于用户目标、能力评估和学习偏好，通过AI算法生成个性化学习计划，支持计划调整和进度跟踪。

*功能*：
- 学习目标设定
- 能力评估
- AI计划生成
- 计划调整
- 进度跟踪

*性能*：
- 计划生成时间 < 5秒
- 支持复杂学习目标
- 计划准确率 > 80%

*输入项*：
- 学习目标（LearningGoal）
- 能力评估（Assessment）
- 学习偏好（Preferences）
- 历史数据（HistoricalData）

*输出项*：
- 学习计划（LearningPlan）
- 学习阶段（LearningPhase[]）
- 学习任务（LearningTask[]）
- 成功指标（SuccessMetrics[]）

*算法与流程逻辑*：

```
学习规划流程图

开始
  │
  ▼
收集用户信息
  │
  ▼
分析学习目标
  │
  ▼
评估当前能力
  │
  ▼
分析学习偏好
  │
  ▼
构建计划提示词
  │
  ▼
调用AI生成计划
  │
  ▼
解析计划数据
  │
  ▼
验证计划合理性
  │
  ▼
保存学习计划
  │
  ▼
生成每日任务
  │
  ▼
返回计划结果
  │
  ▼
结束
```

*接口*：
```typescript
interface PlanGenerationRequest {
  goal: LearningGoal;
  assessment?: Assessment;
  preferences: LearningPreferences;
  historicalData?: any[];
}

interface PlanGenerationResponse {
  plan: LearningPlan;
  phases: LearningPhase[];
  tasks: LearningTask[];
  metrics: SuccessMetrics[];
}
```

*存储分配*：
- learning_goals表：存储学习目标
- learning_plans表：存储学习计划
- learning_tasks表：存储学习任务
- daily_plans表：存储每日计划

*测试计划*：
- 基础计划生成测试
- 复杂目标测试
- 计划调整测试
- AI异常处理测试
- 计划执行测试
